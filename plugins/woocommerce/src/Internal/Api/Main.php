<?php

namespace Automattic\WooCommerce\Internal\Api;

use Automattic\WooCommerce\Internal\Api\Autogenerated\RestControllersServiceProvider; // !!!AutogeneratedMock
use Automattic\WooCommerce\Utilities\StringUtil;

/**
 * Main controller class for the WooCommerce API.
 */
class Main {
	/**
	 * Initializes the WooCommerce API, needs to be invoked at WooCommerce initialization time.
	 */
	public static function initialize(): void {
		if ( self::is_graphql_request() ) {
			GraphQLController::initialize();
		}
	}

	/**
	 * Get the additional API related service provider classes required by the dependency injection engine
	 * depending on the current request.
	 *
	 * @return array Array of service provider class names.
	 */
	public static function get_extra_service_providers(): array {
		if ( self::is_rest_request() ) {
			return array( RestControllersServiceProvider::class );
		} else {
			return array();
		}
	}

	/**
	 * Check if the current request is for the WooCommerce GraphQL engine.
	 *
	 * @return bool True if the current request is for the WooCommerce GraphQL engine.
	 */
	public static function is_graphql_request(): bool {
		// phpcs:ignore WordPress.Security
		return ( $_SERVER['PATH_INFO'] ?? '' ) === '/wp-json/wc/v4/graphql';
	}

	/**
	 * Check if the current request is for the WooCommerce REST API v4 engine.
	 *
	 * @return bool True if the current request is for the WooCommerce REST API v4 engine.
	 */
	public static function is_rest_request(): bool {
		// phpcs:ignore WordPress.Security
		return StringUtil::starts_with( $_SERVER['PATH_INFO'] ?? '', '/wp-json/wc/v4/' ) && ! self::is_graphql_request();
	}
}
